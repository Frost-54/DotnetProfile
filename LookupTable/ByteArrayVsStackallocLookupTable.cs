using BenchmarkDotNet.Attributes;

namespace DotnetProfile.LookupTable; 

[Description("C# byte array vs stackalloc byte as lookup table")]
[BenchmarkClass("Data")]
public class ByteArrayVsStackallocLookupTable {
      private char c;

      [GlobalSetup]
      public void Setup() {
            c = Random.Shared.Next(0, 15).ToString("X")[0];
      }
      
      [Benchmark]
      public byte CharToHexArray() {
            ReadOnlySpan<byte> table = new byte[] {
                  255, 255, 255, 255, 255, 255, 255, 255,  // 0..7
                  255, 255, 255, 255, 255, 255, 255, 255,  // 8..15
                  255, 255, 255, 255, 255, 255, 255, 255,  // 16..23
                  255, 255, 255, 255, 255, 255, 255, 255,  // 24..31
                  255, 255, 255, 255, 255, 255, 255, 255,  // 32..39
                  255, 255, 255, 255, 255, 255, 255, 255,  // 40..47
                  0,   1,   2,   3,   4,   5,   6,   7,    // 48..55    '0' == 48
                  8,   9,   255, 255, 255, 255, 255, 255,  // 56..63    '9' == 57
                  255, 10,  11,  12,  13,  14,  15,  16,   // 64..71    'A' == 65
                  17,  18,  19,  20,  21,  22,  23,  24,   // 72..79
                  25,  26,  27,  28,  29,  30,  31,  32,   // 80..87
                  33,  34,  35,  255, 255, 255, 255, 255,  // 88..95    'Z' == 90
                  255, 10,  11,  12,  13,  14,  15,  16,   // 96..103   'a' == 97
                  17,  18,  19,  20,  21,  22,  23,  24,   // 104..111
                  25,  26,  27,  28,  29,  30,  31,  32,   // 112..119
                  33,  34,  35,  255, 255, 255, 255, 255,  // 120..127  'z' == 122
            };

            return table[c];
      }
      
      [Benchmark]
      public byte CharToHexStackalloc() {
            ReadOnlySpan<byte> table = stackalloc byte[] {
                  255, 255, 255, 255, 255, 255, 255, 255,  // 0..7
                  255, 255, 255, 255, 255, 255, 255, 255,  // 8..15
                  255, 255, 255, 255, 255, 255, 255, 255,  // 16..23
                  255, 255, 255, 255, 255, 255, 255, 255,  // 24..31
                  255, 255, 255, 255, 255, 255, 255, 255,  // 32..39
                  255, 255, 255, 255, 255, 255, 255, 255,  // 40..47
                  0,   1,   2,   3,   4,   5,   6,   7,    // 48..55    '0' == 48
                  8,   9,   255, 255, 255, 255, 255, 255,  // 56..63    '9' == 57
                  255, 10,  11,  12,  13,  14,  15,  16,   // 64..71    'A' == 65
                  17,  18,  19,  20,  21,  22,  23,  24,   // 72..79
                  25,  26,  27,  28,  29,  30,  31,  32,   // 80..87
                  33,  34,  35,  255, 255, 255, 255, 255,  // 88..95    'Z' == 90
                  255, 10,  11,  12,  13,  14,  15,  16,   // 96..103   'a' == 97
                  17,  18,  19,  20,  21,  22,  23,  24,   // 104..111
                  25,  26,  27,  28,  29,  30,  31,  32,   // 112..119
                  33,  34,  35,  255, 255, 255, 255, 255,  // 120..127  'z' == 122
            };

            return table[c];
      }
}